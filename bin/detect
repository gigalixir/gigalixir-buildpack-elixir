#!/usr/bin/env bash

build_pack_dir=$(cd $(dirname $(dirname $0)); pwd)

set -o errexit    # always exit on error
set -o pipefail   # do not ignore exit codes when piping output
unset GIT_DIR     # Avoid GIT_DIR leak from previous build steps

mkdir -p $1 $2 $3 # Ensure dirs are present

build_dir=$(cd $1 && pwd)

# we assume Releases for all builds, Mix will require .buildpacks file for now, distillery is deprecated

mix_file_url="$build_dir/mix.exs"

source ${build_pack_dir}/lib/common.sh

load_config

if [ -f $mix_file_url ]; then
  detect_phoenix
  echo -n "Elixir"
  if $phoenix_detected; then
    echo -n "+Phoenix"
  fi
  echo -n "+Releases"
  echo ""
  exit 0
else
  exit 1
fi

